# How to read Excel files in Python

There are many ways to do this - here we will consider the following:

- using the python standard library: [csv module](https://docs.python.org/3/library/csv.html)
- using [pandas](https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_excel.html)
- using [pyexcel](http://docs.pyexcel.org/en/latest/index.html)
- others?? send me your own way to do this!

In the `data` folder, there is a `data.xlsx` file that was generated by me. It is actually a simple CSV file - saved in .xlsx format. Let's see how every module fares at this task.

Let's go !

The data, for reference:

    date	    item	price
    13-nov-20	t-shirt	5.00
    14-nov-20	t-shirt	5.01
    15-nov-20	t-shirt	5.02
    16-nov-20	t-shirt	5.03
    17-nov-20	t-shirt	5.04
    18-nov-20	t-shirt	5.05
    19-nov-20	t-shirt	5.06
    20-nov-20	t-shirt	5.07
    21-nov-20	t-shirt	5.08
    22-nov-20	t-shirt	5.09

## using the csv module

This module is not able to read `.xlsx` files that are not CSV files. If our test_data was saved as a CSV, this is what we could do...

Following the documentation, we have the following code (also included in `csv_load_excel.py` file):

    import csv

    with open('csv_data.xlsx', newline='') as excel_file:
        xcl_rdr = csv.reader(excel_file, dialect='excel'):
        for row in xcl_rdr:
            print(row)

Running the same code but with `test_data.xlsx` instead of `csv_data.xlsx` will give us an error.

## using pandas

Can pandas read CSV files AND excel files ? We will see !!

Doing so gave me the following warning:

    ImportError: Missing optional dependency 'xlrd'. Install xlrd >= 1.0.0 for Excel support Use pip or conda to install xlrd.

So let's install that - afterwards, we will try using xlrd directly instead.

Let's try reading the CSV file first, and print out the head of that dataframe:

    import pandas

    df = pandas.read_excel('csv_data.xlsx')
    print(df.head(5))

This should not work on your computer: it gave me the following error:

    xlrd.biffh.XLRDError: Unsupported format, or corrupt file: Expected BOF record;

I am not that much of an expert in `.xlsx` file format, I guess that BOF stands for "beginning of file"?


Reading a properly created and saved .xlsx file, like the `test_data.xlsx` file in the current folder, will give us the right result:

    import pandas

    df_xlsx = pandas.read_excel('test_data.xlsx')
    print(df_xlsx.head(5))

This should print out the first five row of the data, with no errors - hurray!

## using pyexcel

Note for the current doc: "The pyexcel DOES NOT consider Fonts, Styles, Formulas and Charts at all. When you load a stylish excel and update it, you definitely will lose all those styles."

I believe this would applies to other libraries for reading xlsx files... let's come back to this later.

Let's try reading the csv data file first

    import pyexcel 

    sheet = pyexcel.get_sheet(file_name="csv_data.xlsx")
    print(sheet)

I get the following error:

    pyexcel_io.exceptions.SupportingPluginAvailableButNotInstalled: Please install one of these plugins for read data in 'xlsx': pyexcel-xls,pyexcel-xlsx

Let's install these!

After installing both `pyexcel-xls` and `pyexcel-xlsx` , I am running into the following error:

    xlrd.biffh.XLRDError: Unsupported format, or corrupt file: Expected BOF record; found b'dates,de'

A BOF error - again! We will definitely come back to this error later.

Let's try loading the proper excel sheet then?

    import pyexcel

    sheet = pyexcel.get_sheet(file_name="test_data.xlsx")
    print(sheet)

It loads - and it pretty prints it too. You should have something like this:

    Feuil1:
    +----------+---------+-------+
    | date     | item    | price |
    +----------+---------+-------+
    | 13/11/20 | t-shirt | 5.00  |
    +----------+---------+-------+
    | 14/11/20 | t-shirt | 5.01  |
    +----------+---------+-------+
    | 15/11/20 | t-shirt | 5.02  |
    +----------+---------+-------+
    | 16/11/20 | t-shirt | 5.03  |
    +----------+---------+-------+
    | 17/11/20 | t-shirt | 5.04  |
    +----------+---------+-------+
    | 18/11/20 | t-shirt | 5.05  |
    +----------+---------+-------+
    | 19/11/20 | t-shirt | 5.06  |
    +----------+---------+-------+
    | 20/11/20 | t-shirt | 5.07  |
    +----------+---------+-------+
    | 21/11/20 | t-shirt | 5.08  |
    +----------+---------+-------+
    | 22/11/20 | t-shirt | 5.09  |
    +----------+---------+-------+


## going back to xlrd

So, what was the thing about xlrd - the library used by pandas?

I guess it stands for e**x**ce**l** **r**ea**d**.... excelread, xlrd!!

Let's look at the [doc](https://xlrd.readthedocs.io/en/latest/)...

And let's try running the following code on the csv file:

    import xlrd

    book = xlrd.open_workbook('csv_data.xlsx')
    print(book)

This should give you a BOF error.

And now, with the proper excel file ?

    import xlrd

    book = xlrd.open_workbook('test_data.xlsx')
    print(book)

Printing out this book does not pretty print it - it gives us:
    
    <xlrd.book.Book object at 0x7f988a959f10>

That's it for now :)


